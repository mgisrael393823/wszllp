"use client"
var L=Object.defineProperty;var F=(t,a)=>L(t,"name",{value:a,configurable:!0});import{useEffect as Y}from"react";import ee from"lodash-es/get.js";import te from"lodash-es/has.js";import{useForm as re}from"react-hook-form";import{useForm as se,useWarnAboutChange as ae,useTranslate as oe,useRefineContext as ne,flattenObjectKeys as z}from"@refinedev/core";var C=F(({refineCoreProps:t,warnWhenUnsavedChanges:a,disableServerSideValidation:p=!1,...g}={})=>{let{options:R}=ne(),h=(R==null?void 0:R.disableServerSideValidation)||p,U=oe(),{warnWhenUnsavedChanges:v,setWarnWhen:f}=ae(),V=a??v,o=re({...g}),{watch:c,setValue:y,getValues:i,handleSubmit:n,setError:E}=o,x=se({...t,onMutationError:(r,s,e)=>{var b,H;if(h){(b=t==null?void 0:t.onMutationError)==null||b.call(t,r,s,e);return}let m=r==null?void 0:r.errors;for(let D in m){if(!Object.keys(z(s)).includes(D))continue;let u=m[D],B="";Array.isArray(u)&&(B=u.join(" ")),typeof u=="string"&&(B=u),typeof u=="boolean"&&u&&(B="Field is not valid."),typeof u=="object"&&"key"in u&&(B=U(u.key,u.message)),E(D,{message:B})}(H=t==null?void 0:t.onMutationError)==null||H.call(t,r,s,e)}}),{query:l,onFinish:d,formLoading:S,onFinishAutoSave:M}=x;Y(()=>{var e;let r=(e=l==null?void 0:l.data)==null?void 0:e.data;if(!r)return;Object.keys(z(i())).forEach(m=>{let b=te(r,m),H=ee(r,m);b&&y(m,H)})},[l==null?void 0:l.data,y,i]),Y(()=>{let r=c((s,{type:e})=>{e==="change"&&W(s)});return()=>r.unsubscribe()},[c]);let W=F(r=>{var s,e;if(V&&f(!0),(s=t==null?void 0:t.autoSave)!=null&&s.enabled){f(!1);let m=((e=t.autoSave)==null?void 0:e.onFinish)??(b=>b);return M(m(r)).catch(b=>b)}return r},"onValuesChange"),Q=F((r,s)=>async e=>(f(!1),n(r,s)(e)),"handleSubmit");return{...o,handleSubmit:Q,refineCore:x,saveButtonProps:{disabled:S,onClick:r=>{Q(s=>d(s).catch(()=>{}),()=>!1)(r)}}}},"useForm");import{useEffect as de,useState as Te}from"react";import ie from"lodash-es/get.js";var le=F(({stepsProps:t,...a}={})=>{let{defaultStep:p=0,isBackValidate:g=!1}=t??{},[R,h]=Te(p),U=C({...a}),{trigger:v,getValues:f,setValue:V,formState:{dirtyFields:o},refineCore:{query:c}}=U;de(()=>{var x;let n=(x=c==null?void 0:c.data)==null?void 0:x.data;if(!n)return;let E=Object.keys(f());console.log({dirtyFields:o,registeredFields:E,data:n}),Object.entries(n).forEach(([l,d])=>{let S=l;E.includes(S)&&(ie(o,S)||V(S,d))})},[c==null?void 0:c.data,R,V,f]);let y=F(n=>{let E=n;n<0&&(E=0),h(E)},"go");return{...U,steps:{currentStep:R,gotoStep:F(async n=>{if(n===R)return;if(n<R&&!g){y(n);return}await v()&&y(n)},"gotoStep")}}},"useStepsForm");import{useCallback as J}from"react";import{useGo as ue,useModal as pe,useParsed as ce,useResource as me,useUserFriendlyName as Fe,useTranslate as Re,useWarnAboutChange as ye,useInvalidate as Ee}from"@refinedev/core";import P from"react";var xe=F(({modalProps:t,refineCoreProps:a,syncWithLocation:p,...g}={})=>{var A,N;let R=Ee(),[h,U]=P.useState(!1),v=Re(),{resource:f,action:V}=a??{},{resource:o,action:c,identifier:y}=me(f),i=ce(),n=ue(),E=Fe(),x=V??c??"",l=!(typeof p=="object"&&(p==null?void 0:p.syncId)===!1),d=typeof p=="object"&&"key"in p?p.key:o&&x&&p?`modal-${y}-${x}`:void 0,{defaultVisible:S=!1,autoSubmitClose:M=!0,autoResetForm:W=!0}=t??{},Q=C({refineCoreProps:{...a,meta:{...d?{[d]:void 0}:{},...a==null?void 0:a.meta}},...g}),{reset:$,refineCore:{onFinish:r,id:s,setId:e,autoSaveProps:m},saveButtonProps:b,handleSubmit:H}=Q,{visible:D,show:k,close:u}=pe({defaultVisible:S});P.useEffect(()=>{var T,j,K,I;if(h===!1&&d){let w=(j=(T=i==null?void 0:i.params)==null?void 0:T[d])==null?void 0:j.open;if(typeof w=="boolean"?w&&k():typeof w=="string"&&w==="true"&&k(),l){let G=(I=(K=i==null?void 0:i.params)==null?void 0:K[d])==null?void 0:I.id;G&&(e==null||e(G))}U(!0)}},[d,i,l,e]),P.useEffect(()=>{var T;h===!0&&(D&&d?n({query:{[d]:{...(T=i==null?void 0:i.params)==null?void 0:T[d],open:!0,...l&&s&&{id:s}}},options:{keepQuery:!0},type:"replace"}):d&&!D&&n({query:{[d]:void 0},options:{keepQuery:!0},type:"replace"}))},[s,D,k,d,l]);let B=F(async T=>{await r(T),M&&u(),W&&$()},"submit"),{warnWhen:O,setWarnWhen:X}=ye(),Z=J(()=>{var T;if(m.status==="success"&&((T=a==null?void 0:a.autoSave)!=null&&T.invalidateOnClose)&&R({id:s,invalidates:a.invalidates||["list","many","detail"],dataProviderName:a.dataProviderName,resource:y}),O)if(window.confirm(v("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))X(!1);else return;e==null||e(void 0),u()},[O,m.status]),_=J(T=>{typeof T<"u"&&(e==null||e(T)),(!(x==="edit"||x==="clone")||(typeof T<"u"||typeof s<"u"))&&k()},[s]),q=v(`${y}.titles.${V}`,void 0,`${E(`${V} ${((A=o==null?void 0:o.meta)==null?void 0:A.label)??((N=o==null?void 0:o.options)==null?void 0:N.label)??(o==null?void 0:o.label)??y}`,"singular")}`);return{modal:{submit:B,close:Z,show:_,visible:D,title:q},...Q,saveButtonProps:{...b,onClick:T=>H(B)(T)}}},"useModalForm");export{C as useForm,xe as useModalForm,le as useStepsForm};
//# sourceMappingURL=index.mjs.map