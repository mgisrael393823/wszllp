"use client"
var le=Object.create;var M=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var y=(e,t)=>M(e,"name",{value:t,configurable:!0});var Fe=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})},L=(e,t,s,D)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of pe(t))!me.call(e,n)&&n!==s&&M(e,n,{get:()=>t[n],enumerable:!(D=ue(t,n))||D.enumerable});return e};var K=(e,t,s)=>(s=e!=null?le(ce(e)):{},L(t||!e||!e.__esModule?M(s,"default",{value:e,enumerable:!0}):s,e)),Re=e=>L(M({},"__esModule",{value:!0}),e);var ye={};Fe(ye,{useForm:()=>C,useModalForm:()=>oe,useStepsForm:()=>ae});module.exports=Re(ye);var Y=require("react"),ee=K(require("lodash/get")),te=K(require("lodash/has")),re=require("react-hook-form"),E=require("@refinedev/core");var C=y(({refineCoreProps:e,warnWhenUnsavedChanges:t,disableServerSideValidation:s=!1,...D}={})=>{let{options:n}=(0,E.useRefineContext)(),H=(n==null?void 0:n.disableServerSideValidation)||s,g=(0,E.useTranslate)(),{warnWhenUnsavedChanges:Q,setWarnWhen:B}=(0,E.useWarnAboutChange)(),S=t??Q,d=(0,re.useForm)({...D}),{watch:F,setValue:x,getValues:p,handleSubmit:T,setError:b}=d,f=(0,E.useForm)({...e,onMutationError:(a,o,r)=>{var V,k;if(H){(V=e==null?void 0:e.onMutationError)==null||V.call(e,a,o,r);return}let R=a==null?void 0:a.errors;for(let h in R){if(!Object.keys((0,E.flattenObjectKeys)(o)).includes(h))continue;let m=R[h],U="";Array.isArray(m)&&(U=m.join(" ")),typeof m=="string"&&(U=m),typeof m=="boolean"&&m&&(U="Field is not valid."),typeof m=="object"&&"key"in m&&(U=g(m.key,m.message)),b(h,{message:U})}(k=e==null?void 0:e.onMutationError)==null||k.call(e,a,o,r)}}),{query:c,onFinish:i,formLoading:v,onFinishAutoSave:A}=f;(0,Y.useEffect)(()=>{var r;let a=(r=c==null?void 0:c.data)==null?void 0:r.data;if(!a)return;Object.keys((0,E.flattenObjectKeys)(p())).forEach(R=>{let V=(0,te.default)(a,R),k=(0,ee.default)(a,R);V&&x(R,k)})},[c==null?void 0:c.data,x,p]),(0,Y.useEffect)(()=>{let a=F((o,{type:r})=>{r==="change"&&N(o)});return()=>a.unsubscribe()},[F]);let N=y(a=>{var o,r;if(S&&B(!0),(o=e==null?void 0:e.autoSave)!=null&&o.enabled){B(!1);let R=((r=e.autoSave)==null?void 0:r.onFinish)??(V=>V);return A(R(a)).catch(V=>V)}return a},"onValuesChange"),j=y((a,o)=>async r=>(B(!1),T(a,o)(r)),"handleSubmit");return{...d,handleSubmit:j,refineCore:f,saveButtonProps:{disabled:v,onClick:a=>{j(o=>i(o).catch(()=>{}),()=>!1)(a)}}}},"useForm");var P=require("react"),se=K(require("lodash/get"));var ae=y(({stepsProps:e,...t}={})=>{let{defaultStep:s=0,isBackValidate:D=!1}=e??{},[n,H]=(0,P.useState)(s),g=C({...t}),{trigger:Q,getValues:B,setValue:S,formState:{dirtyFields:d},refineCore:{query:F}}=g;(0,P.useEffect)(()=>{var f;let T=(f=F==null?void 0:F.data)==null?void 0:f.data;if(!T)return;let b=Object.keys(B());console.log({dirtyFields:d,registeredFields:b,data:T}),Object.entries(T).forEach(([c,i])=>{let v=c;b.includes(v)&&((0,se.default)(d,v)||S(v,i))})},[F==null?void 0:F.data,n,S,B]);let x=y(T=>{let b=T;T<0&&(b=0),H(b)},"go");return{...g,steps:{currentStep:n,gotoStep:y(async T=>{if(T===n)return;if(T<n&&!D){x(T);return}await Q()&&x(T)},"gotoStep")}}},"useStepsForm");var z=require("react"),u=require("@refinedev/core");var $=K(require("react"));var oe=y(({modalProps:e,refineCoreProps:t,syncWithLocation:s,...D}={})=>{var X,Z;let n=(0,u.useInvalidate)(),[H,g]=$.default.useState(!1),Q=(0,u.useTranslate)(),{resource:B,action:S}=t??{},{resource:d,action:F,identifier:x}=(0,u.useResource)(B),p=(0,u.useParsed)(),T=(0,u.useGo)(),b=(0,u.useUserFriendlyName)(),f=S??F??"",c=!(typeof s=="object"&&(s==null?void 0:s.syncId)===!1),i=typeof s=="object"&&"key"in s?s.key:d&&f&&s?`modal-${x}-${f}`:void 0,{defaultVisible:v=!1,autoSubmitClose:A=!0,autoResetForm:N=!0}=e??{},j=C({refineCoreProps:{...t,meta:{...i?{[i]:void 0}:{},...t==null?void 0:t.meta}},...D}),{reset:J,refineCore:{onFinish:a,id:o,setId:r,autoSaveProps:R},saveButtonProps:V,handleSubmit:k}=j,{visible:h,show:w,close:m}=(0,u.useModal)({defaultVisible:v});$.default.useEffect(()=>{var l,W,G,_;if(H===!1&&i){let O=(W=(l=p==null?void 0:p.params)==null?void 0:l[i])==null?void 0:W.open;if(typeof O=="boolean"?O&&w():typeof O=="string"&&O==="true"&&w(),c){let q=(_=(G=p==null?void 0:p.params)==null?void 0:G[i])==null?void 0:_.id;q&&(r==null||r(q))}g(!0)}},[i,p,c,r]),$.default.useEffect(()=>{var l;H===!0&&(h&&i?T({query:{[i]:{...(l=p==null?void 0:p.params)==null?void 0:l[i],open:!0,...c&&o&&{id:o}}},options:{keepQuery:!0},type:"replace"}):i&&!h&&T({query:{[i]:void 0},options:{keepQuery:!0},type:"replace"}))},[o,h,w,i,c]);let U=y(async l=>{await a(l),A&&m(),N&&J()},"submit"),{warnWhen:I,setWarnWhen:ne}=(0,u.useWarnAboutChange)(),de=(0,z.useCallback)(()=>{var l;if(R.status==="success"&&((l=t==null?void 0:t.autoSave)!=null&&l.invalidateOnClose)&&n({id:o,invalidates:t.invalidates||["list","many","detail"],dataProviderName:t.dataProviderName,resource:x}),I)if(window.confirm(Q("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))ne(!1);else return;r==null||r(void 0),m()},[I,R.status]),Te=(0,z.useCallback)(l=>{typeof l<"u"&&(r==null||r(l)),(!(f==="edit"||f==="clone")||(typeof l<"u"||typeof o<"u"))&&w()},[o]),ie=Q(`${x}.titles.${S}`,void 0,`${b(`${S} ${((X=d==null?void 0:d.meta)==null?void 0:X.label)??((Z=d==null?void 0:d.options)==null?void 0:Z.label)??(d==null?void 0:d.label)??x}`,"singular")}`);return{modal:{submit:U,close:de,show:Te,visible:h,title:ie},...j,saveButtonProps:{...V,onClick:l=>k(U)(l)}}},"useModalForm");
//# sourceMappingURL=index.cjs.map